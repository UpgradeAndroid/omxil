AC_INIT(configure.in)
AM_INIT_AUTOMAKE(libomxil, B0.3.0)
AC_PROG_CC
AM_PROG_LIBTOOL
AC_PROG_INSTALL
# This flag should be commented working with Fedora Core 4
# where the default compiler is gcc 4.0.0 and it produces
# several warning due to OpenMAX standard type definition

#CFLAGS="${CFLAGS=} -Werror -g"

# Check if Alsa sound library is present
AC_CHECK_LIB(asound, snd_pcm_plugin_init, [with_alsalibrary=true], [with_alsalibrary=false])
AC_CHECK_HEADER(alsa/asoundlib.h, [], [with_alsalibrary=false])
AM_CONDITIONAL(WITH_ALSASINK, test x$with_alsalibrary = xtrue)

#Check for ffmpeg components dependencies
AC_CHECK_LIB(avcodec, avcodec_decode_audio, [with_ffmpeglibrary=true], [with_ffmpeglibrary=false])
AC_CHECK_HEADER(ffmpeg/avcodec.h, [], [with_ffmpeglibrary=false])
AC_CHECK_HEADER(ffmpeg/avformat.h, [], [with_ffmpeglibrary=false])
AM_CONDITIONAL(WITH_FFMPEGLIBRARY, test x$with_ffmpeglibrary = xtrue)

#Check whether ffmpeg components have been requested
AC_ARG_ENABLE(ffmpegcomponents,
  AC_HELP_STRING([--disable-ffmpegcomponents], [whether to disable ffmpeg components compilation]),
  [with_ffmpegcomponents=false],
  [with_ffmpegcomponents=true]) dnl default
AM_CONDITIONAL(WITH_FFMPEGCOMPONENTS, test x$with_ffmpegcomponents = xtrue && test x$with_ffmpeglibrary = xtrue)

#Check whether alsa component has been requested
AC_ARG_ENABLE(alsacomponent,
  AC_HELP_STRING([--disable-alsacomponent], [whether to disable alsa component compilation]),
  [with_alsacomponent=false],
  [with_alsacomponent=true]) dnl default
AM_CONDITIONAL(WITH_ALSACOMPONENT, test x$with_alsacomponent = xtrue && test x$with_alsalibrary = xtrue)

#Check whether alsa component has been requested
AC_ARG_ENABLE(audioeffects,
  AC_HELP_STRING([--disable-audioeffects], [whether to disable the audio effects components compilation]),
  [with_audioeffects=false],
  [with_audioeffects=true]) dnl default
AM_CONDITIONAL(WITH_AUDIOEFFECTS, test x$with_audioeffects = xtrue)

AC_OUTPUT([
	Makefile		\
	libomxil.pc		\
	include/Makefile        \
	src/Makefile		\
	src/base/Makefile		\
	src/components/Makefile	\
	src/components/alsa/Makefile	\
	src/components/ffmpeg/Makefile	\
	src/components/audio_effects/Makefile	\
	test/Makefile		\
	test/components/Makefile	\
	test/components/alsasink/Makefile \
	test/components/audio_effects/Makefile \
	test/components/ffmpeg/Makefile
])
